<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Emotion Music Recommendation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Bigelow+Rules&display=swap"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='style.css') }}"
      rel="stylesheet"
    />
  </head>

  <body>
    <header class="header">
      <a href="#" class="logo"><h3>eMuse</h3></a>
      <nav class="navbar">
        <a class="under" href="#home"> Home </a>
        <a class="under" href="#aboutproject">Project</a>
        <a class="under" href="#aboutus">About</a>
        <a class="under" href="#services">Services</a>
        <a class="under" href="#contactus">Feedback</a>
      </nav>
    </header>
    <section class="home" id="home">
      <div class="slider">
        <div class="home-content">
          <h3 class="home-welcome">Welcome To</h3>
          <h1 class="home-welcomes">eMuse</h1>
        </div>
      </div>
    </section>

    <section class="about-emuse" id="aboutproject">
      <div class="overlay">
        <div class="about-content">
          <h2 class="heading">About <span>Emuse</span></h2>
          <p>
            Feel the Music, We Hear Your Emotions By analyzing these emotional
            cues, these systems curate playlists that perfectly match our moods,
            enhancing our listening experience. This personalized approach helps
            users discover new favorites and tailor their soundtracks to life's
            various moments. eMuse, for instance, leverages this technology to
            ensure that every song resonates with how you feel, making music a
            more intimate and responsive companion.
          </p>
        </div>
      </div>
    </section>
    <section class="about-us" id="aboutus">
      <h1>About US</h1>
      <div class="wrap">
        <div class="cards-container">
          <div
            class="card"
            style="
              width: 18rem;
              background-color: white;
              border-radius: 8px;
              padding: 20px;
            "
          >
            <div>
              <div class="card-heading">
                <h3 class="heading-hover">Swetha</h3>
              </div>
              <div class="card-context">
                <p>
                  I am Swetha currently pursuing Btech 3rd year in AI&DS branch
                  at VNRVJIET. In this project I have worked on Web Developmemt
                  and Documentation.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="cards-container">
          <div
            class="card"
            style="
              width: 18rem;
              background-color: white;
              border-radius: 8px;
              padding: 20px;
            "
          >
            <div>
              <div class="card-heading">
                <h3 class="heading-hover">Hemasree Vemulamada</h3>
              </div>
              <div class="card-context">
                <p>
                  I am Hemasree currently pursuing Btech 3rd year in AI&DS
                  branch at VNRVJIET. I have worked on Machine Learning Model
                  and web Development.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="cards-container">
          <div
            class="card"
            style="
              width: 18rem;
              background-color: white;
              border-radius: 8px;
              padding: 20px;
            "
          >
            <div>
              <div class="card-heading">
                <h3 class="heading-hover">Roshini Reddy</h3>
              </div>
              <div class="card-context">
                <p>
                  I am Roshini Reddy currently pursuing Btech 3rd year in AI&DS
                  branch at VNRVJIET.I have worked on WebDevelopment and Spotify
                  Connection to the Model
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="services" class="section">
      <p class="section-header">Services</p>
      <div class="container">
        <div class="left">
          <h2
            style="
              font-family: 'sans-serif';
              font-size: 30px;
              text-align: center;
            "
          >
            Emotion Detector
          </h2>
          <div class="video-container">
            <img
              class="outer-shadow"
              id="bg"
              class="center img-fluid"
              src="{{ url_for('video_feed') }}"
            />
          </div>
        </div>

        <div class="right">
          <h2
            style="
              font-family: 'sans-serif';
              font-size: 30px;
              text-align: center;
            "
          >
            Song Recommendations
          </h2>
          <div class="recommendation-table-container">
            <div class="outer-shadow" id="ResultArea"></div>
          </div>
        </div>
      </div>
    </section>
    <section class="ContactUs" id="contactus">
      <div class="feedback-section">
        <h2 style="color: #16213e; font-weight: bolder; text-align: center">
          GIVE US YOUR FEEDBACK
        </h2>
        <p style="color: black; text-align: center">
          We value your opinion. Please share your feedback with us!
        </p>
        <div class="feedback-container">
          <form id="feedbackForm">
            <div class="input-group">
              <input
                type="text"
                name="name"
                id="name"
                class="input-field"
                placeholder="Your Name"
              />
              <input
                type="email"
                name="email"
                id="email"
                class="input-field"
                placeholder="Your Email"
              />
            </div>
            <textarea
              id="feedback"
              name="feedback"
              class="input-field feedback-textarea"
              placeholder="Your Feedback"
            ></textarea>
            <p>Rate your experience:</p>
            <div class="rating">
              <span>★</span><span>★</span><span>★</span><span>★</span
              ><span>★</span>
            </div>
            <button type="submit" class="send">SUBMIT FEEDBACK</button>
          </form>
        </div>
      </div>
    </section>

    <footer>
      <div class="footer">
        <div class="title">
          <h1>eMuse</h1>
        </div>
        <div class="contact-us">
          <h2>Contact Us</h2>
          <input
            type="email"
            name="email"
            id="contact-email"
            class="contact"
          /><br /><br />
          <button class="send">Send</button>
        </div>
        <div class="row">
          <h3>Links</h3>
          <div class="links">
            <a href="#home">Home</a>
            <a href="#aboutproject">Project</a>
            <a href="#aboutus">About</a>
            <a href="#services">Services</a>
            <a href="#contactus">Feedback</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document
        .getElementById("feedbackForm")
        .addEventListener("submit", function (event) {
          var name = document.getElementById("name").value.trim();
          var email = document.getElementById("email").value.trim();
          var feedback = document.getElementById("feedback").value.trim();

          if (name === "" || email === "" || feedback === "") {
            alert("Please fill in all fields before submitting the form.");
            event.preventDefault();
          }
        });

      // Function to update video feed
      function updateVideoFeed() {
        $("#bg").attr("src", "/video_feed?" + new Date().getTime()); // Ensure the video feed updates
      }

      let stopButtonClicked = false;

      // Function to handle detect button click
      $(".button").on("click", function () {
        stopEmotionDetection();
      });

      // Function to handle refresh button click
      $(".refresh").on("click", function () {
        refreshPage();
      });

      // Function to stop emotion detection
      function stopEmotionDetection() {
        $.ajax({
          type: "GET",
          url: "/stop_emotion_detection",
          success: function (response) {
            stopButtonClicked = true;
            console.log("Emotion detection stopped successfully.");
            updateVideoFeed();
          },
          error: function (error) {
            console.log("Error stopping emotion detection:", error);
          },
        });
      }

      // Function to start emotion detection
      function startEmotionDetection() {
        $.ajax({
          type: "GET",
          url: "/start_emotion_detection",
          success: function (response) {
            stopButtonClicked = false;
            console.log("Emotion detection started successfully.");
            updateVideoFeed(); // Ensure the video feed updates and shows the emotion tag
          },
          error: function (error) {
            console.log("Error starting emotion detection:", error);
          },
        });
      }

      // Function to periodically update the table
      setInterval(function () {
        if (!stopButtonClicked) {
          $.getJSON("/t", function (data) {
            createHtmlTable(data);
          });
        }
      }, 1000);

      // Function to create HTML table from data
      function createHtmlTable(data) {
        $("#ResultArea").html("");
        var table = $(
          "<table class='table table-striped table-light table-bordered table-hover table-sm table-responsive' id='DynamicTable'></table>"
        ).appendTo("#ResultArea");
        var rowHeader = $("<tr></tr>").appendTo(table);
        $("<td></td>").text("Name").appendTo(rowHeader);
        $("<td></td>").text("Album").appendTo(rowHeader);
        $("<td></td>").text("Artist").appendTo(rowHeader);
        $("<td></td>").text("Spotify Link").appendTo(rowHeader);
        $.each(data, function (i, value) {
          var row = $("<tr></tr>").appendTo(table);
          $("<td></td>").text(value.Name).appendTo(row);
          $("<td></td>").text(value.Album).appendTo(row);
          $("<td></td>").text(value.Artist).appendTo(row);
          $("<td></td>")
            .html(
              '<a href="' +
                value["Spotify Link"] +
                '" target="_blank">' +
                value["Spotify Link"] +
                "</a>"
            )
            .appendTo(row);
        });
      }

      // Function to refresh the page
      function refreshPage() {
        setTimeout(function () {
          $("#ResultArea").html(""); // Clear results
          startEmotionDetection();
        }, 200);
      }

      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute("href")).scrollIntoView({
              behavior: "smooth",
            });
          });
        });
      });
    </script>
  </body>
</html>
