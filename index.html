<!DOCTYPE html>
<html lang="en">

<head>
  <title>Emotion Music Recommendation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Bigelow+Rules&display=swap" rel="stylesheet">
  <link href="style.css" rel="stylesheet" />
</head>

<body>
   <header class="header">
    <a href="#" class="logo"><h3>eMuse</h3></a>
      <nav class="navbar">
        <a class="under" href="#home" >
          Home
        </a>
        <a class="under" href="#aboutproject" >Project</a>
        <a class="under" href="#aboutus" >About</a>
        <a class="under"  href="#services" >Services</a>
      </nav>
   </header>
   <section class="home" id="home">
    <div class="slider">
      <div class="home-content">
        <h3 class="home-welcome">Welcome To</h3>
        <h1 class="home-welcomes">eMuse</h1>
      </div> 
    </div>
   </section>

   <section class="about-emuse" id="aboutproject">

    <div class="overlay">
      <div class="about-content">
        <h2 class="heading">About <span>Emuse</span></h2>
        <p>
          Feel the Music, We Hear Your Emotions
          By analyzing these emotional cues, these systems curate playlists that perfectly match our moods, enhancing our listening experience. This personalized approach helps users discover new favorites and tailor their soundtracks to life's various moments. eMuse, for instance, leverages this technology to ensure that every song resonates with how you feel, making music a more intimate and responsive companion.
        </p>
      </div>
    </div>

   </section>
   <section class="about-us" id="aboutus">
    <h1>About US</h1>
   <div class="wrap">
    <div class="cards-container">
      <div class="card"
        style="width: 18rem; background-color:white; border-radius: 8px; padding: 20px;">
        <div>
          <div class="card-heading">
            <h3 class="heading-hover">Swetha</h3>
          </div>
          <div class="card-context">
            <p></p>
          </div>
        </div>
      </div>
    </div>
    <div class="cards-container">
      <div class="card"
        style="width: 18rem; background-color:white; border-radius: 8px; padding: 20px;">
        <div>
          <div class="card-heading">
            <h3 class="heading-hover">Hemasree Vemulamada</h3>
          </div>
          <div class="card-context">
            <p></p>
          </div>
        </div>
      </div>
    </div>
    <div class="cards-container">
      <div class="card"
        style="width: 18rem; background-color:white; border-radius: 8px; padding: 20px;">
        <div>
          <div class="card-heading">
            <h3 class="heading-hover">Roshini Reddy</h3>
          </div>
          <div class="card-context">
            <p></p>
          </div>
        </div>
      </div>
    </div>
   </div>
   

   </section>
    
  
      <section id="services" class="section">
        <p class="section-header">Services</p>
        <div class="container">
          <div class="left">
            <h2 style="font-family: 'sans-serif'; font-size: 30px; text-align: center;">Emotion Detector</h2>
            <div class="video-container">
              <img class="outer-shadow" id="bg" class="center img-fluid" src="{{ url_for('video_feed') }}">
            </div>
          </div>
          
          <div class="right">
            <h2 style="font-family: 'sans-serif'; font-size: 30px;  text-align: center;">Song Recommendations</h2>
            <div class="recommendation-table-container">
              <div class="outer-shadow" id="ResultArea"></div>
            </div>
          </div>
          
        </div>
        <div class="btncontainer">
          <button class="refresh" id="refreshButton">Refresh</button>
          <button class="button" id="stopButton">Detect</button>
        </div>
      </section>
    </div>
    
    <footer>
       <div class="footer">
        <div class="title">
          <h1>eMuse</h1>
        </div>
        <div class="row" >
          <h3>Links</h3>
          <div class="links">
            <a href="#home">Home</a>
            <a href="#aboutproject">Project</a>
            <a href="#aboutus">About</a>
            <a href="#services">Services</a>
          </div>
        </div>
       </div>
    </footer>


  <script>
    // Function to update video feed
  function updateVideoFeed() {
    $("#bg").attr("src", "/video_feed?" + new Date().getTime()); // Ensure the video feed updates
  }
  </script>
  

  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript">
    let stopButtonClicked = false;

    // Function to handle detect button click
    $(".button").on("click", function () {
      stopEmotionDetection();
    });

    // Function to handle refresh button click
    $(".refresh").on("click", function () {
      refreshPage();
    });

    // Function to stop emotion detection
    function stopEmotionDetection() {
      $.ajax({
        type: "GET",
        url: "/stop_emotion_detection",
        success: function (response) {
          stopButtonClicked = true;
          console.log("Emotion detection stopped successfully.");
          updateVideoFeed();
        },
        error: function (error) {
          console.log("Error stopping emotion detection:", error);
        },
      });
    }

    // Function to start emotion detection
    function startEmotionDetection() {
      $.ajax({
        type: "GET",
        url: "/start_emotion_detection",
        success: function (response) {
          stopButtonClicked = false;
          console.log("Emotion detection started successfully.");
          updateVideoFeed(); // Ensure the video feed updates and shows the emotion tag
        },
        error: function (error) {
          console.log("Error starting emotion detection:", error);
        },
      });
    }

    // Function to periodically update the table
    setInterval(function () {
      if (!stopButtonClicked) {
        $.getJSON("/t", function (data) {
          createHtmlTable(data);
        });
      }
    }, 1000);

    // Function to create HTML table from data
    function createHtmlTable(data) {
      $("#ResultArea").html("");
      var table = $("<table class='table table-striped table-light table-bordered table-hover table-sm table-responsive' id='DynamicTable'></table>").appendTo("#ResultArea");
      var rowHeader = $("<tr></tr>").appendTo(table);
      $("<td></td>").text("Name").appendTo(rowHeader);
      $("<td></td>").text("Album").appendTo(rowHeader);
      $("<td></td>").text("Artist").appendTo(rowHeader);
      $("<td></td>").text("Spotify Link").appendTo(rowHeader);
      $.each(data, function (i, value) {
        var row = $("<tr></tr>").appendTo(table);
        $("<td></td>").text(value.Name).appendTo(row);
        $("<td></td>").text(value.Album).appendTo(row);
        $("<td></td>").text(value.Artist).appendTo(row);
        $("<td></td>")
          .html('<a href="' + value["Spotify Link"] + '" target="_blank">' + value["Spotify Link"] + "</a>")
          .appendTo(row);
      });
    }

    // Function to refresh the page
    function refreshPage() {
      setTimeout(function () {
        $("#ResultArea").html(""); // Clear results
        startEmotionDetection();
      }, 200); 
    }

   

    document.addEventListener("DOMContentLoaded", function () {
      const toggleButton = document.querySelector(".navbar-toggle");
      const menu = document.querySelector(".navbar-menu");
      const menuLinks = document.querySelectorAll(".navbar-menu a");
      toggleButton.addEventListener("click", function () {
        menu.classList.t);
      });
      menuLinks.forEach((link) => {
        link.addEventListener("click", function () {
          menu.classList.r);
        });
      });
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          document.querySelector(this.getAttribute("href")).scrollIntoView({
            behavior: "smooth",
          });
        });
      });
    });
  </script>

</body>

</html>
